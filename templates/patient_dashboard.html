{% extends "base.html" %} {% block title %}Patient Dashboard{% endblock %} {%
block content %}
<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Patient Dashboard</h2>
    <a href="{{ url_for('book_appointment') }}" class="btn btn-primary"
      >Book Appointment</a
    >
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <h5 class="card-title">
        Welcome, {{ patient.name if patient else 'Patient' }}
      </h5>
      <p class="card-text">
        Email: {{ patient.email if patient else '-' }}<br />
        Contact: {{ patient.contact if patient else '-' }}<br />
        Age: {{ patient.age if patient else '-' }}
      </p>
    </div>
  </div>

  <h4>Your Appointments</h4>
  {% if appointments %}
  <table class="table table-striped">
    <thead>
      <tr>
        <th>#</th>
        <th>Doctor</th>
        <th>Date</th>
        <th>Time</th>
        <th>Reason</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for appt in appointments %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>
          {{ appt.doctor_name or (appt.doctor.user.name if appt.doctor and
          appt.doctor.user else '-') }}
        </td>
        <td>{{ appt.date }}</td>
        <td>{{ appt.time }}</td>
        <td>{{ appt.reason }}</td>
        <td>{{ appt.status }}</td>
        <td>
          {% if session.get('role') == 'patient' %}
          <form
            action="{{ url_for('cancel_appointment', appointment_id=appt.id) }}"
            method="post"
            style="display: inline"
          >
            <button
              class="btn btn-sm btn-danger"
              ()
              {%
              if
              appt.status
              !="pending"
              %}disabled{%
              endif
              %}
            >
              Cancel
            </button>
          </form>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>
    No appointments found.
    <a href="{{ url_for('book_appointment') }}">Book one now.</a>
  </p>
  {% endif %}
</div>
{% endblock %}
